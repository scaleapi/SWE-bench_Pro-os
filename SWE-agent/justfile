USERNAME := "$(whoami)"

# Build the Docker image for SWE Agent
build:
    docker build \
        -t sweagent-image:{{USERNAME}} \
        -f SWEAgent.Dockerfile . && \
    echo "Built image with tag: sweagent-image:{{USERNAME}}"


# Run the docker container with the necessary mounts, onboarding the modal credentials
# and a results directory to write to as well as the config directories.
run:
    mkdir -p $(pwd)/sweagent_results && \
    docker run -it --rm --ipc=host \
    --name sweagent-{{USERNAME}} \
    --env-file $(pwd)/.env \
    -v "/mnt/efs/{{USERNAME}}/.modal.toml:/root/.modal.toml" \
    -v "$(pwd)/config:/app/config" \
    -v "$(pwd)/sweagent_wrapper_configs:/app/sweagent_wrapper_configs" \
    -v "$(pwd)/sweagent_results:/app/sweagent_results" \
    --add-host=host.docker.internal:host-gateway \
    sweagent-image:{{USERNAME}}